---
title: "Figure S1 Comparison of FLEXITau and DDA 3R/4R ratio calculation in primary and secondary cohort"
author: "Christoph N. Schlaffner"
output:
  pdf_document: default
  html_document: default
---
```{r, include=FALSE}
options(stringsAsFactors = FALSE)
library(reshape2)
library(ggplot2)
library(scales)
library(ggpubr)
library(gridExtra)

summarize <- function (datainput,testinput,testname) {
  agg.sd <- aggregate(as.numeric(datainput$RisoformRatio),list(datainput$Neuropathology),sd)
  agg.sum <- aggregate(as.numeric(datainput$RisoformRatio),list(datainput$Neuropathology),summary)
  agg.sum.tmp <- agg.sum$Group.1
  agg.sum <- as.data.frame(unclass(agg.sum$x))
  agg.sum$group2 <- agg.sum.tmp
  colnames(agg.sum)
  test.all <- as.data.frame(testinput)
  agg.sum <- merge(agg.sum,test.all,all=T)
  agg.sum <- agg.sum[,c(8,1:7,11)]
  agg.sum[agg.sum$group2=="CTR",]$.y. <- "RisoformRatio"
  colnames(agg.sum) <- c("Group","Neuropathology","Min","1st Quartile","Median","Mean","3rd Quartile","Max","adjusted p-value")
  colnames(agg.sd) <- c("Neuropathology","Standard Deviation")
  agg.sum$Group <- rep(testname,dim(agg.sum)[1])
  agg.sum <- merge(agg.sum,agg.sd,all=TRUE)
  agg.sum <- agg.sum[,c("Group","Neuropathology","Min","1st Quartile","Median","Mean","3rd Quartile","Max","Standard Deviation","adjusted p-value")]
  return(agg.sum)
}

math_format2 <- function (expr = 10^.x, expr2 = .x, format = force) 
{
  .x <- NULL
  quoted <- substitute(expr)
  subs <- function(x) {
    do.call("substitute", list(quoted, list(.x = x)))
  }
  quoted2 <- substitute(expr2)
  subs2 <- function(x) {
    do.call("substitute", list(quoted2, list(.x = x)))
  }
  function(x) {
    x[x==1] <- 10
    x[x==0] <- 1
    x <- format(x)
    ret <- lapply(x, subs)
    ret <- as.expression(ret)
    ret[is.na(x)] <- NA
    names(ret) <- names(x)
    ret2 <- lapply(x, subs2)
    ret2 <- as.expression(ret2)
    ret2[is.na(x)] <- NA
    names(ret2) <- names(x)
    ret[x%in%c(1,10)] <- ret2[x%in%c(1,10)]
    ret
  }
  
}

linesize <- 0.8

anno_colors <- list(Isoform=c(N0="#BEBADA",N1="#FDB462",N2="#F781BF",R3="#66C2A5",R4="#80B1D3","#FFFFFF"),
                    NPDX1=c(fAD="#9C0B0C",NPCAD="#FF17E3",AD="#E41A1C",CAA="#914B00",CBD="#FFD92F",CTE="#1740B6",CTR="#4DAF4A",DLB="#8DD3C7",FTLD="#17DFFF",PiD="#984EA3",PSP="#FF7F00",FTLD="#18BCD6",HS="#24B39B",HSTDP="#2BE0C2",HEMR="#EB5456",HEMT="#AD4041",CVD="#FB9A99",INF="#FC8D62",MEN="#FCCDE5",AS="#E5C494",PD="#E7298A",MAL="#BC80BD",ALS="#E31A1C",DMP="#BEBADA",NFD="#1F78B4",ELC="#1B9E77",AHYP="#3890B0",CON="#F781BF",SNL="#FDCDAC",FETGI="#80B1D3",AGD="#545454","#FFFFFF"),
                    NPDX2=c(fAD="#9C0B0C",NPCAD="#FF17E3",AD="#E41A1C",CAA="#914B00",CBD="#FFD92F",CTE="#1740B6",CTR="#4DAF4A",DLB="#8DD3C7",FTLD="#17DFFF",PiD="#984EA3",PSP="#FF7F00",FTLD="#18BCD6",HS="#24B39B",HSTDP="#2BE0C2",HEMR="#EB5456",HEMT="#AD4041",CVD="#FB9A99",INF="#FC8D62",MEN="#FCCDE5",AS="#E5C494",PD="#E7298A",MAL="#BC80BD",ALS="#E31A1C",DMP="#BEBADA",NFD="#1F78B4",ELC="#1B9E77",AHYP="#3890B0",CON="#F781BF",SNL="#FDCDAC",FETGI="#80B1D3",AGD="#545454","#FFFFFF")
)
testmethod <- "t.test"
pvaluecorrection <- "fdr"
p.label <- "p={p.adj}"
#p.label <- "p.signif"
pvalsize.pval <- 6
astersize <- 6
pvalsize <- pvalsize.pval

titlesize <- 20
axistitlesize <- 16
axistextsize <- 16

logticks_left <- annotation_logticks(sides='l',short=unit(0.15,"cm"),mid=unit(0.15,"cm"),long=unit(0.25,"cm"),size=linesize)
logticks_left$data <- data.frame(x=NA, Neuropathology=factor("CTR",levels=c("CTR","DLB","PSP","PiD","FTLD","CBD","CTE","fAD","AD")))
logticks_right <- annotation_logticks(sides='r',short=unit(0.15,"cm"),mid=unit(0.15,"cm"),long=unit(0.25,"cm"),size=linesize)
logticks_right$data <- data.frame(x=NA, Neuropathology=factor("AD",levels=c("CTR","DLB","PSP","PiD","FTLD","CBD","CTE","fAD","AD")))

math_function3 <- function(x) {
  x <- x[round(x,0)==x]
  10^x
}



file_FLEXI <- "D:/Data/Tau_comparisonpaper/FigureScripts/FINALSet/FLEXITau_Ratio_regionratio-collapse_normalized_filtered7.csv" #"D:/Data/Tau_comparisonpaper/FigureScripts/FINALSet/FLEXITau_SEMICOMPLETE.csv"
data_FLEXI <- read.table(file_FLEXI,sep=",",header=FALSE)
data_FLEXI <- data_FLEXI[(data_FLEXI$V3!=""),]

#data_FLEXI[data_FLEXI$V2%in%c("CAA","NPCAD"),]$V2 <- "AD"
data_FLEXI[data_FLEXI$V2%in%c("CTRL"),]$V2 <- "CTR"
#data_FLEXI[data_FLEXI$V2%in%c("FTLDTau"),]$V2 <- "FTLD"
data_FLEXI[data_FLEXI$V1=="FTLD-Tau_01",]$V2 <- "AD"
data_FLEXI[data_FLEXI$V1=="FTLD-Tau_02",]$V2 <- "PSP"
data_FLEXI[data_FLEXI$V1=="FTLD-Tau_03",]$V2 <- "CBD"

data_FLEXI.absolute <- data_FLEXI[,c("V1","V2","V3","V4")]


data_FLEXI.iso.R <- data_FLEXI.absolute[-c(2,3),c(1,2,4)]
colnames(data_FLEXI.iso.R) <- data_FLEXI.iso.R[1,]
data_FLEXI.iso.R <- data_FLEXI.iso.R[-1,]
data_FLEXI.iso.R$Neuropathology <- factor(data_FLEXI.iso.R$Neuropathology,levels=c("CTR","DLB","PSP","PiD","CBD","CTE","fAD","AD"))
data_FLEXI.iso.R$RisoformRatio <- as.numeric(data_FLEXI.iso.R$RisoformRatio)

#data_FLEXI.iso.R$RisoformRatio <- 1/data_FLEXI.iso.R$RisoformRatio

data_FLEXI.iso.R.remove <- aggregate(data_FLEXI.iso.R$RisoformRatio,by=list(data_FLEXI.iso.R$Neuropathology),function(x){sum(is.na(x))+sum(!is.na(x))})
data_FLEXI.iso.R.remove <- data_FLEXI.iso.R.remove[data_FLEXI.iso.R.remove$x<2,]
data_FLEXI.iso.R.test <- data_FLEXI.iso.R
data_FLEXI.iso.R.remove$Group.1 <- as.character(data_FLEXI.iso.R.remove$Group.1)
data_FLEXI.iso.R.test$Neuropathology <- as.character(data_FLEXI.iso.R.test$Neuropathology)
if(dim(data_FLEXI.iso.R.remove)[1]>0) {
  for(i in 1:dim(data_FLEXI.iso.R.remove)[1]) {
    data_FLEXI.iso.R.test <- data_FLEXI.iso.R.test[!(data_FLEXI.iso.R.test$Neuropathology==data_FLEXI.iso.R.remove[i,]$Group.1),]
  }
}

data_FLEXI.iso.R.test$Neuropathology <- factor(data_FLEXI.iso.R.test$Neuropathology,levels=c("CTR","DLB","PSP","PiD","CBD","CTE","fAD","AD"))

Rratio_insoluble_ttest <- compare_means(RisoformRatio~Neuropathology,data=data_FLEXI.iso.R.test,ref.group="CTR",method=testmethod,p.adjust.method=pvaluecorrection)

agg.flexi <- summarize(data_FLEXI.iso.R,Rratio_insoluble_ttest,"4R/3R - Primary Cohort FLEXITau (FLEXITau isoform peptides)")
write.csv(agg.flexi,"D:/Data/Tau_comparisonpaper/FigureScripts/FINALSet/MSFragger/FLEXITau_p-values_20250131.csv",quote=FALSE,row.names=FALSE)

#data_FLEXI.iso.R$Rratio <- log2(data_FLEXI.iso.R$Rratio)
#ylabel.R <- "log2 R3/R4 ratio"
logheights.R <- c(1.8,2,2.2,2.4,2.6)
logheights.R <- c(1.6,2.1,2.6,3.1,3.6)
regheights.R <- c(82.5,87.5,92.5,97.5,102.5)
#logheights.R <- c(1.3,1.6,1.9)
#regheights.R <- c()
ylabel.R <- "ratio [4R/3R]"
heights.R <- logheights.R
plot_R_insoluble <- ggplot(data_FLEXI.iso.R,aes(x=Neuropathology,y=RisoformRatio)) + 
  geom_hline(yintercept=1, linetype="dashed", color = "darkgrey") +
  stat_boxplot(geom="errorbar",width=linesize) +
  geom_boxplot(aes(fill=Neuropathology),lwd=linesize) +
  ggtitle("Primary Cohort FLEXITau\n(FLEXITau isoform peptides)\n4R/3R ratio (exon 10 splicing)") +
  scale_fill_manual(values=anno_colors$NPDX1) +
  #scale_y_continuous(sec.axis=dup_axis(label=NULL,name=""),name=ylabel.R) +
  scale_y_log10(sec.axis=dup_axis(label=NULL,name=""),limits=c(NA,12500),breaks=trans_breaks("log10",function(x) 10^x),labels=trans_format("log10",math_format2(10^.x)),name=ylabel.R) + 
  annotation_logticks(side="l",short=unit(0.15,"cm"),mid=unit(0.15,"cm"),long=unit(0.25,"cm"),size=linesize) +
  annotation_logticks(side="r",short=unit(0.15,"cm"),mid=unit(0.15,"cm"),long=unit(0.25,"cm"),size=linesize) +
  stat_pvalue_manual(Rratio_insoluble_ttest,label=p.label,y.position=heights.R,hide.ns=TRUE,tip.length=0,bracket.size=linesize,label.size=pvalsize) +
  theme_minimal() +
  theme(plot.title=element_text(hjust=0.5,size=titlesize,face="bold"),axis.line=element_line(linewidth=linesize),title=element_text(size=titlesize,face="bold"),axis.ticks=element_line(linewidth=linesize+0.1),axis.title.x=element_blank(),axis.text=element_text(size=axistextsize,face="bold",color="black"),axis.text.x=element_text(angle=90,hjust=1,vjust=0.5),axis.title.y=element_text(size=axistitlesize,face="bold"),legend.position="none")


timsdata <- read.csv("D:/Data/Tau_comparisonpaper/FigureScripts/FINALSet/MSFragger/timsTOF_4Rstartincl_20240807.csv",header=TRUE)
timsdata <- timsdata[,c("Sample","NPDX","X4R3R")]
colnames(timsdata) <- c("ID","Neuropathology","RisoformRatio")
timsdata[timsdata$Neuropathology=="CTRL",]$Neuropathology <- "CTR"

timsdata$Neuropathology <- factor(timsdata$Neuropathology,levels=c("CTR","DLB","PSP","PiD","CBD","CTE","fAD","AD"))
#timsdata$RisoformRatio <- 1/timsdata$RisoformRatio

Rratio_timsdata_ttest <- compare_means(RisoformRatio~Neuropathology,data=timsdata,ref.group="CTR",method=testmethod,p.adjust.method=pvaluecorrection)

agg.timsdata <- summarize(timsdata,Rratio_timsdata_ttest,"4R/3R - Primary Cohort DDA (all isoform peptides)")
write.csv(agg.timsdata,"D:/Data/Tau_comparisonpaper/FigureScripts/FINALSet/MSFragger/TimsData_p-values_20250131.csv",quote=FALSE,row.names=FALSE)


#data_FLEXI.iso.R$Rratio <- log2(data_FLEXI.iso.R$Rratio)
#ylabel.R <- "log2 R3/R4 ratio"
logheights.R <- c(1.8,2,2.2,2.4,2.6)
logheights.R <- c(2.1,2.6)
regheights.R <- c(87.5,92.5,97.5,102.5)
#logheights.R <- c(0.7,1.0,1.3,1.6)
#regheights.R <- c()
ylabel.R <- "ratio [4R/3R]"
heights.R <- logheights.R

plot_R_timsdata <- ggplot(timsdata,aes(x=Neuropathology,y=RisoformRatio)) + 
  geom_hline(yintercept=1, linetype="dashed", color = "darkgrey") +
  stat_boxplot(geom="errorbar",width=linesize) +
  geom_boxplot(aes(fill=Neuropathology),lwd=linesize) +
  ggtitle("Primary Cohort DDA\n(all isoform peptides)\n4R/3R ratio (exon 10 splicing)") +
  scale_fill_manual(values=anno_colors$NPDX1) +
  #scale_y_continuous(sec.axis=dup_axis(label=NULL,name=""),name=ylabel.R) +
  scale_y_log10(sec.axis=dup_axis(label=NULL,name=""),limits=c(NA,12500),breaks=trans_breaks("log10",function(x) 10^x),labels=trans_format("log10",math_format2(10^.x)),name=ylabel.R) + 
  annotation_logticks(side="l",short=unit(0.15,"cm"),mid=unit(0.15,"cm"),long=unit(0.25,"cm"),size=linesize) +
  annotation_logticks(side="r",short=unit(0.15,"cm"),mid=unit(0.15,"cm"),long=unit(0.25,"cm"),size=linesize) +
  stat_pvalue_manual(Rratio_timsdata_ttest,label=p.label,y.position=heights.R,hide.ns=TRUE,tip.length=0,bracket.size=linesize,label.size=pvalsize) +
  theme_minimal() +
  theme(plot.title=element_text(hjust=0.5,size=titlesize,face="bold"),axis.line=element_line(linewidth=linesize),title=element_text(size=titlesize,face="bold"),axis.ticks=element_line(linewidth=linesize+0.1),axis.title.x=element_blank(),axis.text=element_text(size=axistextsize,face="bold",color="black"),axis.text.x=element_text(angle=90,hjust=1,vjust=0.5),axis.title.y=element_text(size=axistitlesize,face="bold"),legend.position="none")

timsdata.single <- read.csv("D:/Data/Tau_comparisonpaper/FigureScripts/FINALSet/MSFragger/timsTOF_4Rstartincl_20240807_FLEXIpeptides.csv",header=TRUE)
timsdata.single <- timsdata.single[,c("Sample","NPDX","X4R3R")]
colnames(timsdata.single) <- c("ID","Neuropathology","RisoformRatio")
timsdata.single[timsdata.single$Neuropathology=="CTRL",]$Neuropathology <- "CTR"

timsdata.single$Neuropathology <- factor(timsdata.single$Neuropathology,levels=c("CTR","DLB","PSP","PiD","CBD","CTE","fAD","AD"))
#timsdata.single$RisoformRatio <- 1/timsdata.single$RisoformRatio

Rratio_timsdata_ttest <- compare_means(RisoformRatio~Neuropathology,data=timsdata.single,ref.group="CTR",method=testmethod,p.adjust.method=pvaluecorrection)

agg.timsdata_single <- summarize(timsdata.single,Rratio_timsdata_ttest,"4R/3R - Primary Cohort DDA (FLEXITau isoform peptides)")
write.csv(agg.timsdata_single,"D:/Data/Tau_comparisonpaper/FigureScripts/FINALSet/MSFragger/TimsData-Single_p-values_20250131.csv",quote=FALSE,row.names=FALSE)


#data_FLEXI.iso.R$Rratio <- log2(data_FLEXI.iso.R$Rratio)
#ylabel.R <- "log2 R3/R4 ratio"
logheights.R <- c(1.8,2,2.2,2.4,2.6)
logheights.R <- c(2.1,2.6)
regheights.R <- c(87.5,92.5,97.5,102.5)
#logheights.R <- c(0.7,1.0,1.3,1.6)
#regheights.R <- c()
ylabel.R <- "ratio [4R/3R]"
heights.R <- logheights.R

plot_R_timsdata_single <- ggplot(timsdata.single,aes(x=Neuropathology,y=RisoformRatio)) + 
  geom_hline(yintercept=1, linetype="dashed", color = "darkgrey") +
  stat_boxplot(geom="errorbar",width=linesize) +
  geom_boxplot(aes(fill=Neuropathology),lwd=linesize) +
  ggtitle("Primary Cohort DDA\n(FLEXITau isoform peptides)\n4R/3R ratio (exon 10 splicing)") +
  scale_fill_manual(values=anno_colors$NPDX1) +
  #scale_y_continuous(sec.axis=dup_axis(label=NULL,name=""),name=ylabel.R) +
  scale_y_log10(sec.axis=dup_axis(label=NULL,name=""),limits=c(NA,12500),breaks=trans_breaks("log10",function(x) 10^x),labels=trans_format("log10",math_format2(10^.x)),name=ylabel.R) + 
  annotation_logticks(side="l",short=unit(0.15,"cm"),mid=unit(0.15,"cm"),long=unit(0.25,"cm"),size=linesize) +
  annotation_logticks(side="r",short=unit(0.15,"cm"),mid=unit(0.15,"cm"),long=unit(0.25,"cm"),size=linesize) +
  stat_pvalue_manual(Rratio_timsdata_ttest,label=p.label,y.position=heights.R,hide.ns=TRUE,tip.length=0,bracket.size=linesize,label.size=pvalsize) +
  theme_minimal() +
  theme(plot.title=element_text(hjust=0.5,size=titlesize,face="bold"),axis.line=element_line(linewidth=linesize),title=element_text(size=titlesize,face="bold"),axis.ticks=element_line(size=linesize+0.1),axis.title.x=element_blank(),axis.text=element_text(size=axistextsize,face="bold",color="black"),axis.text.x=element_text(angle=90,hjust=1,vjust=0.5),axis.title.y=element_text(size=axistitlesize,face="bold"),legend.position="none")


qe2data <- read.csv("D:/Data/Tau_comparisonpaper/FigureScripts/FINALSet/MSFragger/QE2_4Rstartincl_20240807.csv",header=TRUE,)
qe2data <- qe2data[,c("Sample","NPDX","X4R3R")]
colnames(qe2data) <- c("ID","Neuropathology","RisoformRatio")

qe2data$Neuropathology <- factor(qe2data$Neuropathology,levels=c("CTR","PSP","PiD","CBD","AD"))
#qe2data$RisoformRatio <- 1/qe2data$RisoformRatio
qe2data <- qe2data[!is.na(qe2data$RisoformRatio),]

Rratio_qe2data_ttest <- compare_means(RisoformRatio~Neuropathology,data=qe2data,ref.group="CTR",method=testmethod,p.adjust.method=pvaluecorrection)

agg.qe2data <- summarize(qe2data,Rratio_qe2data_ttest,"4R/3R - Secondary Cohort DDA (all isoform peptides)")
write.csv(agg.qe2data,"D:/Data/Tau_comparisonpaper/FigureScripts/FINALSet/MSFragger/QE2data_p-values_20250131.csv",quote=FALSE,row.names=FALSE)


#data_FLEXI.iso.R$Rratio <- log2(data_FLEXI.iso.R$Rratio)
#ylabel.R <- "log2 R3/R4 ratio"
logheights.R <- c(1.8,2)
logheights.R <- c(2.1,2.6)
logheights.R <- c(2.1)
regheights.R <- c(87.5,92.5,97.5,102.5)
#logheights.R <- c(1.0,1.3)
#regheights.R <- c()
ylabel.R <- "ratio [4R/3R]"
heights.R <- logheights.R

plot_R_qe2data <- ggplot(qe2data,aes(x=Neuropathology,y=RisoformRatio)) + 
  geom_hline(yintercept=1, linetype="dashed", color = "darkgrey") +
  stat_boxplot(geom="errorbar",width=linesize) +
  geom_boxplot(aes(fill=Neuropathology),lwd=linesize) +
  ggtitle("Secondary Cohort DDA\n(all isoform peptides)\n4R/3R ratio (exon 10 splicing)") +
  scale_fill_manual(values=anno_colors$NPDX1) +
  #scale_y_continuous(sec.axis=dup_axis(label=NULL,name=""),name=ylabel.R) +
  scale_y_log10(sec.axis=dup_axis(label=NULL,name=""),limits=c(NA,12500),breaks=trans_breaks("log10",function(x) 10^x),labels=trans_format("log10",math_format2(10^.x)),name=ylabel.R) + 
  annotation_logticks(side="l",short=unit(0.15,"cm"),mid=unit(0.15,"cm"),long=unit(0.25,"cm"),size=linesize) +
  annotation_logticks(side="r",short=unit(0.15,"cm"),mid=unit(0.15,"cm"),long=unit(0.25,"cm"),size=linesize) +
  stat_pvalue_manual(Rratio_qe2data_ttest,label=p.label,y.position=heights.R,hide.ns=TRUE,tip.length=0,bracket.size=linesize,label.size=pvalsize) +
  theme_minimal() +
  theme(plot.title=element_text(hjust=0.5,size=titlesize,face="bold"),axis.line=element_line(linewidth=linesize),title=element_text(size=titlesize,face="bold"),axis.ticks=element_line(size=linesize+0.1),axis.title.x=element_blank(),axis.text=element_text(size=axistextsize,face="bold",color="black"),axis.text.x=element_text(angle=90,hjust=1,vjust=0.5),axis.title.y=element_text(size=axistitlesize,face="bold"),legend.position="none")


qe2data_single <- read.csv("D:/Data/Tau_comparisonpaper/FigureScripts/FINALSet/MSFragger/QE2_4Rstartincl_20240807_FLEXIpeptides.csv",header=TRUE)
qe2data_single <- qe2data_single[,c("Sample","NPDX","X4R3R")]
colnames(qe2data_single) <- c("ID","Neuropathology","RisoformRatio")

qe2data_single$Neuropathology <- factor(qe2data_single$Neuropathology,levels=c("CTR","PSP","PiD","CBD","AD"))
#qe2data_single$RisoformRatio <- 1/qe2data_single$RisoformRatio
qe2data_single <- qe2data_single[!is.na(qe2data_single$RisoformRatio),]

Rratio_qe2data_ttest <- compare_means(RisoformRatio~Neuropathology,data=qe2data_single,ref.group="CTR",method=testmethod,p.adjust.method=pvaluecorrection)

agg.qe2data_single <- summarize(qe2data_single,Rratio_qe2data_ttest,"4R/3R - Secondary Cohort DDA (FLEXITau isoform peptides)")
write.csv(agg.qe2data_single,"D:/Data/Tau_comparisonpaper/FigureScripts/FINALSet/MSFragger/QE2data-Single_p-values_20250131.csv",quote=FALSE,row.names=FALSE)


#data_FLEXI.iso.R$Rratio <- log2(data_FLEXI.iso.R$Rratio)
#ylabel.R <- "log2 R3/R4 ratio"
logheights.R <- c(1.8,2)
logheights.R <- c(2.1,2.6)
logheights.R <- c(2.1)
regheights.R <- c(87.5,92.5,97.5,102.5)
#logheights.R <- c(1.0,1.3)
#regheights.R <- c()
ylabel.R <- "ratio [4R/3R]"
heights.R <- logheights.R

plot_R_qe2data_single <- ggplot(qe2data_single,aes(x=Neuropathology,y=RisoformRatio)) + 
  geom_hline(yintercept=1, linetype="dashed", color = "darkgrey") +
  stat_boxplot(geom="errorbar",width=linesize) +
  geom_boxplot(aes(fill=Neuropathology),lwd=linesize) +
  ggtitle("Secondary Cohort DDA\n(FLEXITau isoform peptides)\n4R/3R ratio (exon 10 splicing)") +
  scale_fill_manual(values=anno_colors$NPDX1) +
  #scale_y_continuous(sec.axis=dup_axis(label=NULL,name=""),name=ylabel.R) +
  scale_y_log10(sec.axis=dup_axis(label=NULL,name=""),limits=c(NA,12500),breaks=trans_breaks("log10",function(x) 10^x),labels=trans_format("log10",math_format2(10^.x)),name=ylabel.R) + 
  annotation_logticks(side="l",short=unit(0.15,"cm"),mid=unit(0.15,"cm"),long=unit(0.25,"cm"),size=linesize) +
  annotation_logticks(side="r",short=unit(0.15,"cm"),mid=unit(0.15,"cm"),long=unit(0.25,"cm"),size=linesize) +
  stat_pvalue_manual(Rratio_qe2data_ttest,label=p.label,y.position=heights.R,hide.ns=TRUE,tip.length=0,bracket.size=linesize,label.size=pvalsize) +
  theme_minimal() +
  theme(plot.title=element_text(hjust=0.5,size=titlesize,face="bold"),axis.line=element_line(linewidth=linesize),title=element_text(size=titlesize,face="bold"),axis.ticks=element_line(size=linesize+0.1),axis.title.x=element_blank(),axis.text=element_text(size=axistextsize,face="bold",color="black"),axis.text.x=element_text(angle=90,hjust=1,vjust=0.5),axis.title.y=element_text(size=axistitlesize,face="bold"),legend.position="none")


plot_R_flexiwesselingdata <- ggplot(qe2data,aes(x=Neuropathology,y=RisoformRatio)) + 
  #geom_hline(yintercept=1, linetype="dashed", color = "darkgrey") +
  #stat_boxplot(geom="errorbar",width=linesize) +
  #geom_boxplot(aes(fill=Neuropathology),lwd=linesize) +
  ggtitle("Wesseling et al.\n(FELXITau isoform peptides)\n4R-3R comparison (exon 10 splicing)") +
  #scale_fill_manual(values=anno_colors$NPDX1) +
  #scale_y_continuous(sec.axis=dup_axis(label=NULL,name=""),name=ylabel.R) +
  #scale_y_log10(sec.axis=dup_axis(label=NULL,name=""),limits=c(NA,12500),breaks=trans_breaks("log10",function(x) 10^x),labels=trans_format("log10",math_format2(10^.x)),name=ylabel.R) + 
  #annotation_logticks(side="l",short=unit(0.15,"cm"),mid=unit(0.15,"cm"),long=unit(0.25,"cm"),size=linesize) +
  #annotation_logticks(side="r",short=unit(0.15,"cm"),mid=unit(0.15,"cm"),long=unit(0.25,"cm"),size=linesize) +
  #stat_pvalue_manual(Rratio_qe2data_ttest,label=p.label,y.position=heights.R,hide.ns=TRUE,tip.length=0,bracket.size=linesize,label.size=pvalsize) +
  theme_void() +
  theme(plot.title=element_text(hjust=0.5,size=titlesize,face="bold"),axis.line=element_blank(),title=element_text(size=titlesize,face="bold"),axis.ticks=element_blank(),axis.title.x=element_blank(),axis.text=element_blank(),axis.text.x=element_blank(),axis.title.y=element_blank(),legend.position="none")


labelsize <- 22
layout <- t(cbind(c(1,1,1,1,2,2,2,2,3,3,3,3),
                  c(1,1,1,1,2,2,2,2,3,3,3,3),
                  c(4,4,4,4,5,5,5,5,NA,NA,NA,NA),
                  c(4,4,4,4,5,5,5,5,NA,NA,NA,NA)))

#layout <- t(cbind(c(1,1,1,1,2,2,2,2,3,3,3,3),
#                  c(1,1,1,1,2,2,2,2,3,3,3,3),
#                  c(4,4,4,4,5,5,5,5,6,6,6,6),
#                  c(4,4,4,4,5,5,5,5,6,6,6,6)))

p_all <- grid.arrange(grobs=list(plot_R_timsdata_single,plot_R_timsdata,plot_R_insoluble,plot_R_qe2data_single,plot_R_qe2data),layout_matrix=layout)

#p_all <- grid.arrange(grobs=list(plot_R_insoluble,plot_R_timsdata,plot_R_timsdata_single,plot_R_flexiwesselingdata,plot_R_qe2data,plot_R_qe2data_single),layout_matrix=layout)

outfilename <- "D:/Data/Tau_comparisonpaper/FigureScripts/FINALSet/MSFragger/Comparison-4Rto3R_20250131.png"

ggsave(outfilename,p_all,device="png",width=8.32,height=5.12,units="in",scale=2)
outfilename <- "D:/Data/Tau_comparisonpaper/FigureScripts/FINALSet/MSFragger/Comparison-4Rto3R_20250131.pdf"

ggsave(outfilename,p_all,device="pdf",width=8.32,height=5.12,units="in",scale=3)

labelsize <- 22
layout <- t(cbind(c(1,1,1,2,2,2,3,3,3),
                  c(1,1,1,2,2,2,3,3,3)))

p_all <- grid.arrange(grobs=list(plot_R_timsdata_single,plot_R_timsdata,plot_R_insoluble),layout_matrix=layout)

outfilename <- "D:/Data/Tau_comparisonpaper/FigureScripts/FINALSet/MSFragger/Comparison-4Rto3R_20250131_supplement.png"

ggsave(outfilename,p_all,device="png",width=8.32,height=2.56,units="in",scale=2)

outfilename <- "D:/Data/Tau_comparisonpaper/FigureScripts/FINALSet/MSFragger/Comparison-4Rto3R_20250131_supplement.pdf"
ggsave(outfilename,p_all,device="pdf",width=8.32,height=2.56,units="in",scale=2)
```
