---
title: "TSNE dimensionality mapping to 2D space from top most features of RF classifiers"
author: "Christoph N. Schlaffner"
output:
  pdf_document: default
  html_document: default
---
```{r, include=FALSE}
library(ggplot2)
library(Rtsne)


plot.umap.tsne <- function(df,title.txt){
  
  library(ggrepel)
  ggplot(df, aes(x, y, colour = disease)) +
    geom_point(size=3)+
    #scale_shape_manual(title.txt, subtitle = "",
    #                   x="Dimension 1",
    #                   y="Dimension 2")+
    geom_text(aes(label=label.id),hjust=0, vjust=0, size=3) +
    #geom_label_repel(aes(label = label.id),  box.padding   = 0.35,      point.padding = 0.5,  segment.color = 'grey50')+
    theme(plot.title=element_text(size=30, hjust=0.5, face="bold", colour="maroon", vjust=-1),
          plot.subtitle=element_text(size=25, hjust=0.5, face="italic", color="black"),
          axis.text.x = element_text(color = "grey20", size = 20, angle = 0, hjust = .5, vjust = .5, face = "plain"),
          axis.text.y = element_text(color = "grey20", size = 20, angle = 0, hjust = 1, vjust = 0, face = "plain"),  
          axis.title.x = element_text(color = "grey20", size = 20, angle = 0, hjust = .5, vjust = 0, face = "plain"),
          axis.title.y = element_text(color = "grey20", size = 20, angle = 90, hjust = .5, vjust = .5, face = "plain"))
  
}


infile <- "D:/Data/Tau_comparisonpaper/FigureScripts/FINALSet/ForShaojun/PTM_ComparisonManuscript_Main_CTR-DLBcomb_20240607.csv"
outfile <- "D:/Data/Tau_comparisonpaper/FigureScripts/FINALSet/ForShaojun/PTM_ComparisonManuscript_Main_CTR-DLBcomb_20250131_5Features.csv"
indata <- read.table(infile,header=FALSE,sep=",")

colnames(indata) <- indata[1,]
rownames(indata) <- c("Name","Type","Site","Isoform",indata[-c(1,2,3,4),1])
indata.headers <- indata[c(1,2,3,4),]
indata <- indata[-c(1,2,3,4),]

rownames(indata) <- c("Peptide","Site","Name",indata[-c(1,2,3),1])
indata.headers <- indata[c(1,2,3),]
indata <- indata[-c(1,2,3),]

ofinterest <- which(indata.headers[3,]%in%c("F8","M11","E12","T30","G109","S113","P182","A227","Q244","A246","V300","P301",
                              "G302","G303","G304","S305","Q307","I308","V309","P312","G323","G326","N327","H329","K353","S356","L357","D358","K396","E372",
                              "D387","G401","T403","L408","S409","T427","A429","A434"))
#top 5
ofinterest <- which(indata.headers[3,]%in%c("M11","G109","S113","Q244","A246","V300","P301",
                                            "G303","G304","S305","Q307","V309","P312","G326","N327","H329","S356","L357","D358","E372",
                                            "D387","T403"))


ofinterest <- which(indata.headers[1,]%in%c("Acetyl(K)@148_2N4R","Phospho(T)@181_2N4R","Phospho(T)@205_2N4R", "Phospho(S)@208_2N4R",
                                            "Citrullination(R)@209_2N4R", "Citrullination(R)@211_2N4R", "Phospho(T)@217_2N4R", "Phospho(T)@231_2N4R",
                                            "Citrullination(R)@242_2N4R", "GG(K)@257_2N4R", "GG(K)@259_2N4R", "Phospho(S)@262_2N4R", "Phospho(T)@263_2N4R", "GG(K)@267_2N4R",
                                            "Acetyl(K)@281_2N4R", "GG(K)@290_2N4R", "Phospho(S)@305_2N4R", "Acetyl(K)@311_2N4R", "GG(K)@311_2N4R", "Acetyl(K)@317_2N4R", "GG(K)@317_2N4R",
                                            "Acetyl(K)@321_2N4R", "GG(K)@321_2N4R","Acetyl(K)@331_2N4R", "GG(K)@331_2N4R", "Acetyl(K)@340_2N4R", "GG(K)@340_2N4R", "Acetyl(K)@353_2N4R",
                                            "GG(K)@353_2N4R", "Phospho(S)@356_2N4R", "Acetyl(K)@369_2N4R", "Acetyl(K)@370_2N4R", "GG(K)@370_2N4R",
                                            "Phospho(S)@396_2N4R", "Phospho(S)@400_2N4R", "Phospho(T)@403_2N4R", "Phospho(S)@404_2N4R", "Phospho(S)@412_2N4R", "Phospho(T)@414_2N4R"))
#top 5
ofinterest <- which(indata.headers[1,]%in%c("Phospho(T)@205_2N4R", "Phospho(S)@208_2N4R",
                                            "Citrullination(R)@209_2N4R", "Citrullination(R)@211_2N4R", "Phospho(T)@217_2N4R", "Phospho(T)@231_2N4R",
                                            "Citrullination(R)@242_2N4R", "Phospho(S)@262_2N4R", "Phospho(T)@263_2N4R", "GG(K)@267_2N4R",
                                            "Acetyl(K)@281_2N4R", "GG(K)@290_2N4R", "Acetyl(K)@311_2N4R", "GG(K)@311_2N4R", "GG(K)@317_2N4R",
                                            "GG(K)@321_2N4R","Acetyl(K)@331_2N4R", "GG(K)@340_2N4R",
                                            "Phospho(S)@356_2N4R", "Acetyl(K)@369_2N4R", "Acetyl(K)@370_2N4R", "GG(K)@370_2N4R","Phospho(S)@396_2N4R", "Phospho(S)@404_2N4R"))

#"TotalTau","RisoformRatio",
ofinterest <- which(indata.headers[1,]%in%c("TotalTau","RisoformRatio","STPTAEDVTAPLVDEGAPGK", "GAAPPGQK", "TPPAPK", "TPPSSGEPPK", "SGYSSPGSPGTPGSR", "SRTPSLPTPPTREPK",
                                            "LQTAPVPMPDLK", "IGSTENLK", "VQIINKK", "KLDLSNVQSK", "IGSLDNITHVPGGGNKK", "AKTDHGAEIVYK", "SPVVSGDTSPR"))

#top 5
ofinterest <- which(indata.headers[1,]%in%c("TotalTau","RisoformRatio","STPTAEDVTAPLVDEGAPGK", "GAAPPGQK", "TPPSSGEPPK", "SGYSSPGSPGTPGSR", "SRTPSLPTPPTREPK",
                                            "IGSTENLK", "VQIINKK", "KLDLSNVQSK", "IGSLDNITHVPGGGNKK", "AKTDHGAEIVYK", "SPVVSGDTSPR"))




ofinterest <- which(indata.headers[1,]%in%c("TotalTau","STPTAEDVTAPLVDEGAPGK", "TPPSSGEPPK", "SGYSSPGSPGTPGSR", "SRTPSLPTPPTREPK",
                                            "LQTAPVPMPDLK", "IGSTENLK", "KLDLSNVQSK", "IGSLDNITHVPGGGNKK", "AKTDHGAEIVYK", "SPVVSGDTSPR"))

#indata <- indata[!(indata$V2=="CTE"),]

indata <- indata[,c(1,2,ofinterest)]
#indata$V3 <- as.numeric(indata$V3)
#indata$V3 <- indata$V3/max(indata$V3)

indata.columns <- indata[,c(1,2)]
indata <- indata[,-c(1,2)]

for(i in 1:dim(indata)[2]) {
  indata[,i] <- as.numeric(indata[,i])
}
indata[,1] <- indata[,1]/max(indata[,1])

set.seed(100)
{
  dat <- indata
  tsne <- Rtsne(dat, normalize=FALSE, check_duplicates = FALSE)
  df <- data.frame(x = tsne$Y[,1],
                   y = tsne$Y[,2],
                   label.id   = indata.columns$ID,
                   disease = indata.columns$Neuropathology)
  write.table(df,file=outfile,sep=",")
  title.txt = "TSNE Disease Distribution"
  p<-plot.umap.tsne(df,title.txt)
  print(p)
}
```